import{a8 as b,f as s,o as n,g as i,b as D,n as w,ak as re,d as se,al as ae,am as le,R as de,an as ue,c as p,j as o,w as l,i as _,z as ce,V as me,m as d,k as pe,S,U as _e,y as j,F as ve,h as fe,t as ge,e as A}from"./index-DtXg1mwU.js";const he={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ke(m,e){return n(),s("svg",he,[...e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6zM8 9h8v10H8zm7.5-5l-1-1h-5l-1 1H5v2h14V4z"},null,-1)])])}const we=b({name:"mdi-delete-outline",render:ke}),ye={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function be(m,e){return n(),s("svg",ye,[...e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7z"},null,-1)])])}const xe=b({name:"mdi-download",render:be}),Ce={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Re(m,e){return n(),s("svg",Ce,[...e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M19 12c0 3.86-3.14 7-7 7s-7-3.14-7-7s3.14-7 7-7s7 3.14 7 7"},null,-1)])])}const $e=b({name:"mdi-record",render:Re}),Se={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Me(m,e){return n(),s("svg",Se,[...e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M8 5.14v14l11-7z"},null,-1)])])}const Ve=b({name:"mdi-play",render:Me}),Be={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function He(m,e){return n(),s("svg",Be,[...e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M14 19h4V5h-4M6 19h4V5H6z"},null,-1)])])}const Ie=b({name:"mdi-pause",render:He}),ze={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ue(m,e){return n(),s("svg",ze,[...e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M17 10.5V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-3.5l4 4v-11z"},null,-1)])])}const je=b({name:"mdi-video",render:Ue}),Ae={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function De(m,e){return n(),s("svg",Ae,[...e[0]||(e[0]=[i("path",{fill:"currentColor",d:"M4 4h3l2-2h6l2 2h3a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2m8 3a5 5 0 0 0-5 5a5 5 0 0 0 5 5a5 5 0 0 0 5-5a5 5 0 0 0-5-5m0 2a3 3 0 0 1 3 3a3 3 0 0 1-3 3a3 3 0 0 1-3-3a3 3 0 0 1 3-3"},null,-1)])])}const Ne=b({name:"mdi-camera",render:De});function Ee({stream:m}){const e=D(()=>MediaRecorder.isTypeSupported("video/webm")),r=w(null),R=w([]),M=re(),u=w("stopped"),v=()=>{const k=new Blob(R.value,{type:"video/webm"}),H=URL.createObjectURL(k);return R.value=[],H};return{isRecordingSupported:e,startRecording:()=>{e.value&&m.value&&u.value==="stopped"&&(r.value=new MediaRecorder(m.value,{mimeType:"video/webm"}),r.value.ondataavailable=k=>{k.data.size>0&&R.value.push(k.data)},r.value.onstop=()=>{M.trigger(v())},r.value.state==="inactive"&&(r.value.start(),u.value="recording"))},stopRecording:()=>{e.value&&r.value&&u.value!=="stopped"&&(r.value.stop(),u.value="stopped")},pauseRecording:()=>{e.value&&r.value&&u.value==="recording"&&(r.value.pause(),u.value="paused")},resumeRecording:()=>{e.value&&r.value&&u.value==="paused"&&(r.value.resume(),u.value="recording")},recordingState:u,onRecordAvailable:M.on}}const Le={key:1,"mt-4":"",flex:"","justify-center":""},Pe={flex:"","flex-col":"","gap-2":""},Te={key:0,"mt-3":"",flex:"","justify-center":""},Ye={key:1},qe={"my-2":""},Fe={flex:"","items-center":"","justify-between":"","gap-2":""},Ge={"mr-2":""},Oe={key:0,flex:"","justify-center":"","gap-2":""},We={"mr-2":""},Je={"mr-2":""},Ke={"mr-2":""},Qe={"mr-2":""},Xe={key:1,italic:"","op-60":""},Ze={grid:"","grid-cols-2":"","mt-5":"","gap-2":""},et=["src"],tt=["src"],nt={flex:"","items-center":"","justify-between":""},ot={"font-bold":""},it={flex:"","gap-2":""},at=se({__name:"camera-recorder",setup(m){const{videoInputs:e,audioInputs:r,permissionGranted:R,isSupported:M,ensurePermissions:u}=ae({requestPermissions:!0,constraints:{video:!0,audio:!0},onUpdated(){F()}}),v=w(),x=w([]),h=w(e.value[0]?.deviceId),f=w(r.value[0]?.deviceId),B=w(!1),{stream:k,start:H,stop:N,enabled:I}=le({constraints:D(()=>({video:{deviceId:h.value},...f.value?{audio:{deviceId:f.value}}:{}})),autoSwitch:!0}),{isRecordingSupported:E,onRecordAvailable:L,startRecording:P,stopRecording:T,pauseRecording:Y,recordingState:V,resumeRecording:q}=Ee({stream:k});L(a=>{x.value.unshift({type:"video",value:a,createdAt:new Date})});function F(){(A.isNil(h)||!e.value.find(a=>a.deviceId===h.value))&&(h.value=e.value[0]?.deviceId),(A.isNil(r)||!r.value.find(a=>a.deviceId===f.value))&&(f.value=r.value[0]?.deviceId)}function G(){if(!v.value)return;const a=document.createElement("canvas");a.width=v.value.videoWidth,a.height=v.value.videoHeight,a.getContext("2d")?.drawImage(v.value,0,0);const t=a.toDataURL("image/png");x.value.unshift({type:"image",value:t,createdAt:new Date})}de(()=>{v.value&&k.value&&(v.value.srcObject=k.value)}),ue(()=>N());async function O(){try{await u()}catch{B.value=!0}}function W({type:a,value:t,createdAt:C}){const $=document.createElement("a");$.href=t,$.download=`${a}-${C.getTime()}.${a==="image"?"png":"webm"}`,$.click()}return(a,t)=>{const C=ce,$=me,g=pe,z=_e,J=Ne,K=je,Q=Ie,X=Ve,Z=$e,ee=xe,te=we;return n(),s("div",null,[o(M)?o(R)?(n(),p(C,{key:2},{default:l(()=>[i("div",Pe,[d(z,{value:o(h),"onUpdate:value":t[0]||(t[0]=c=>j(h)?h.value=c:null),"label-position":"left","label-width":"60px",label:"Video:",options:o(e).map(({deviceId:c,label:y})=>({value:c,label:y})),placeholder:"Select camera"},null,8,["value","options"]),o(f)&&o(r).length>0?(n(),p(z,{key:0,value:o(f),"onUpdate:value":t[1]||(t[1]=c=>j(f)?f.value=c:null),label:"Audio:","label-position":"left","label-width":"60px",options:o(r).map(({deviceId:c,label:y})=>({value:c,label:y})),placeholder:"Select microphone"},null,8,["value","options"])):S("",!0)]),o(I)?(n(),s("div",Ye,[i("div",qe,[i("video",{ref_key:"video",ref:v,autoplay:"",controls:"",playsinline:"","max-h-full":"","w-full":""},null,512)]),i("div",Fe,[d(g,{disabled:!o(I),onClick:G},{default:l(()=>[i("span",Ge,[d(J)]),t[7]||(t[7]=_(" Take screenshot ",-1))]),_:1},8,["disabled"]),o(E)?(n(),s("div",Oe,[o(V)==="stopped"?(n(),p(g,{key:0,onClick:o(P)},{default:l(()=>[i("span",We,[d(K)]),t[8]||(t[8]=_(" Start recording ",-1))]),_:1},8,["onClick"])):S("",!0),o(V)==="recording"?(n(),p(g,{key:1,onClick:o(Y)},{default:l(()=>[i("span",Je,[d(Q)]),t[9]||(t[9]=_(" Pause ",-1))]),_:1},8,["onClick"])):S("",!0),o(V)==="paused"?(n(),p(g,{key:2,onClick:o(q)},{default:l(()=>[i("span",Ke,[d(X)]),t[10]||(t[10]=_(" Resume ",-1))]),_:1},8,["onClick"])):S("",!0),o(V)!=="stopped"?(n(),p(g,{key:3,type:"error",onClick:o(T)},{default:l(()=>[i("span",Qe,[d(Z)]),t[11]||(t[11]=_(" Stop ",-1))]),_:1},8,["onClick"])):S("",!0)])):(n(),s("div",Xe," Video recording is not supported in your browser "))])])):(n(),s("div",Te,[d(g,{type:"primary",onClick:o(H)},{default:l(()=>[...t[6]||(t[6]=[_(" Start webcam ",-1)])]),_:1},8,["onClick"])]))]),_:1})):(n(),p(C,{key:1,"text-center":""},{default:l(()=>[t[5]||(t[5]=_(" You need to grant permission to use your camera and microphone ",-1)),o(B)?(n(),p($,{key:0,"mt-4":"","text-left":""},{default:l(()=>[...t[3]||(t[3]=[_(" Your browser has blocked permission request or does not support it. You need to grant permission manually in your browser settings (usually the lock icon in the address bar). ",-1)])]),_:1})):(n(),s("div",Le,[d(g,{onClick:O},{default:l(()=>[...t[4]||(t[4]=[_(" Grant permission ",-1)])]),_:1})]))]),_:1})):(n(),p(C,{key:0},{default:l(()=>[...t[2]||(t[2]=[_(" Your browser does not support recording video from camera ",-1)])]),_:1})),i("div",Ze,[(n(!0),s(ve,null,fe(o(x),({type:c,value:y,createdAt:ne},U)=>(n(),p(C,{key:U},{default:l(()=>[c==="image"?(n(),s("img",{key:0,src:y,"max-h-full":"","w-full":"",alt:"screenshot"},null,8,et)):(n(),s("video",{key:1,src:y,controls:"","max-h-full":"","w-full":""},null,8,tt)),i("div",nt,[i("div",ot,ge(c==="image"?"Screenshot":"Video"),1),i("div",it,[d(g,{onClick:oe=>W({type:c,value:y,createdAt:ne})},{default:l(()=>[d(ee)]),_:1},8,["onClick"]),d(g,{onClick:oe=>x.value=o(x).filter((rt,ie)=>ie!==U)},{default:l(()=>[d(te)]),_:1},8,["onClick"])])])]),_:2},1024))),128))])])}}});export{at as default};
